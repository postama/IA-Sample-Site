---
const { pathname } = Astro.url;

const links = [
  { name: "ARTICLES", path: "/articles" },
  { name: "ABOUT", path: "/about" },
];

const isActive = (path: string) => 
  path === "/" ? pathname === "/" : pathname.startsWith(path);
---

<header 
  id="industrial-nav" 
  class="fixed top-0 left-0 w-full z-50 bg-ink border-b border-manila h-16 md:h-20 transition-[height] duration-300 ease-[cubic-bezier(0.25,1,0.5,1)]"
>
  <div class="max-w-7xl mx-auto flex items-stretch h-full relative z-20 bg-ink">
    <a 
      href="/" 
      class="flex-grow md:flex-grow-0 group relative flex items-center px-6 md:px-8 border-r border-manila hover:bg-manila/10 transition-colors h-full"
    >
      <span class="font-sans font-black text-lg md:text-2xl tracking-tighter text-manila uppercase group-hover:text-white transition-colors whitespace-nowrap">
        INDUSTRIAL ARTS
      </span>
    </a>

    <div class="hidden md:block flex-grow bg-[url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAQAAAAECAYAAACp8Z5+AAAAIklEQVQIW2nk5+d/D8R79uz5/xqI/wMxFhYW/8fExPwHAIkvBPkTLOmOAAAAAElFTkSuQmCC')] opacity-20 border-r border-manila/20"></div>

    <nav class="hidden md:flex h-full">
      {links.map((link) => {
        const active = isActive(link.path);
        return (
          <a
            href={link.path}
            class:list={[
              "relative flex items-center px-10 border-l border-manila font-mono text-sm tracking-widest transition-all duration-200 h-full",
              active 
                ? "text-white bg-manila/10" 
                : "text-manila hover:bg-manila/5 hover:text-white"
            ]}
          >
            {active && (
              <>
                <span class="absolute top-0 right-0 w-2 h-2 border-l border-b border-manila"></span>
                <span class="absolute bottom-0 left-0 w-2 h-2 border-r border-t border-manila"></span>
              </>
            )}
            <span class="relative z-10">{link.name}</span>
          </a>
        );
      })}
    </nav>

    <button 
      id="mobile-toggle"
      class="md:hidden flex items-center justify-center px-6 border-l border-manila text-manila hover:bg-manila/10 transition-colors active:bg-manila/20"
      aria-label="Toggle Menu"
    >
      <div class="space-y-1.5 pointer-events-none">
        <span class="block w-6 h-0.5 bg-current"></span>
        <span class="block w-6 h-0.5 bg-current"></span>
        <span class="block w-6 h-0.5 bg-current"></span>
      </div>
    </button>
  </div>

  <div 
    id="mobile-menu" 
    class="absolute top-full left-0 w-full bg-ink border-b border-manila overflow-hidden transition-all duration-300 ease-in-out max-h-0 opacity-0 z-10"
  >
    <div class="absolute inset-0 opacity-10 pointer-events-none noise-bg mix-blend-overlay"></div>
    
    <nav class="flex flex-col relative z-20">
      {links.map((link) => {
        const active = isActive(link.path);
        return (
          <a
            href={link.path}
            class:list={[
              "flex items-center px-6 py-4 border-b border-manila/30 font-mono text-sm tracking-widest",
              active ? "text-white bg-manila/10" : "text-manila"
            ]}
          >
             <span class="mr-3 opacity-50">&gt;</span>
             {link.name}
          </a>
        );
      })}
    </nav>
  </div>

</header>

<script>
  // Scroll Logic
  const nav = document.getElementById('industrial-nav');
  const toggleBtn = document.getElementById('mobile-toggle');
  const mobileMenu = document.getElementById('mobile-menu');
  let isMenuOpen = false;

  // Handle Scroll Shrink
  function updateNav() {
    if (!nav) return;
    if (window.scrollY > 50) {
      nav.classList.remove('md:h-20', 'h-16');
      nav.classList.add('md:h-14', 'h-14');
    } else {
      nav.classList.add('md:h-20', 'h-16');
      nav.classList.remove('md:h-14', 'h-14');
    }
  }

  // Handle Mobile Toggle
  toggleBtn?.addEventListener('click', () => {
    isMenuOpen = !isMenuOpen;
    if (mobileMenu) {
      if (isMenuOpen) {
        mobileMenu.classList.remove('max-h-0', 'opacity-0');
        mobileMenu.classList.add('max-h-64', 'opacity-100'); // max-h-64 is arbitrary large enough height
      } else {
        mobileMenu.classList.remove('max-h-64', 'opacity-100');
        mobileMenu.classList.add('max-h-0', 'opacity-0');
      }
    }
  });

  window.addEventListener('scroll', updateNav);
  updateNav();
</script>

<style>  
  .noise-bg {
    background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.85' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)'/%3E%3C/svg%3E");
  }
</style>